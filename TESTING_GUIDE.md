# OnWebReg 驗證改進測試指南

## 快速測試檢清單

### ✅ 基本驗證測試
- [ ] 選擇一個角色
- [ ] 點擊「驗證」按鈕
- [ ] 觀察視窗狀態是否顯示以下內容：
  ```
  連接驗證伺服器中...
  [14:32:45] 開始驗證流程
  ```

### ✅ 成功驗證驗證
- [ ] 若驗證成功，應顯示：
  ```
  ✓ 驗證完成! [14:33:12]
  到期日期: 2025-12-31
  剩餘時間: 340 天
  
  [重新驗證提示]
  上次驗證: 2025-11-20 14:33:12
  下次驗證: 2025-11-27 14:33:12
  剩餘時間: 7 天 0 小時
  ```

### ✅ 超時重試測試
- [ ] 臨時斷網
- [ ] 點擊驗證
- [ ] 觀察日志（Debug Output）：
  ```
  Web In testaccount (Attempt 1/3)
  Timeout for testaccount, attempt 1
  Retrying testaccount in 1000ms...
  Web In testaccount (Attempt 2/3)
  ```

### ✅ 多角色驗證
- [ ] 添加多個角色
- [ ] 一鍵驗證全部
- [ ] 所有角色應順序完成驗證

### ✅ UI 改進驗證
- [ ] 驗證按鈕應為綠色背景
- [ ] 狀態框應有藍色邊框
- [ ] 驗證過程應顯示動畫點（., .., ...）
- [ ] 到期日期應為藍色加粗

---

## 預期的改進

### 大陸用戶
- ✅ 不再因超時而卡住（增加自動重試）
- ✅ 驗證失敗時能看到具體原因
- ✅ 即使網絡慢也能成功驗證

### 台灣用戶
- ✅ 驗證速度更快
- ✅ UI 更清晰直觀
- ✅ 能看到下次重驗時間

### 所有用戶
- ✅ 不再顯示含糊的「驗證失敗」
- ✅ 能看到詳細的驗證時間
- ✅ 知道何時需要重新驗證

---

## 常見問題

### Q: 為什麼驗證顯示「等待超時」？
**A:** 驗證超過 60 秒未完成。可能原因：
- 網絡中斷
- 服務器響應慢
- 帳號信息不匹配

**解決方案**：
1. 檢查網絡連接
2. 稍後重試
3. 確認帳號密碼正確

### Q: 怎樣查看重新驗證時間？
**A:** 驗證完成後，狀態框會自動顯示：
```
[重新驗證提示]
上次驗證: YYYY-MM-DD HH:MM:SS
下次驗證: YYYY-MM-DD HH:MM:SS
剩餘時間: X 天 X 小時
```

### Q: 大陸用戶連接失敗怎麼辦？
**A:** 可以配置備用服務器。編輯 `WebRegistration.cs`：
```csharp
private static readonly string[] ApiEndpoints = new[]
{
    "https://主服務器...", // 當前服務器
    "https://備用服務器..." // 改為實際的備用服務器地址
};
```

### Q: 如何查看詳細的驗證日志？
**A:** 在 Visual Studio 中查看「Debug Output」窗口：
- 菜單：Debug → Windows → Output
- 或快捷鍵：`Ctrl + Alt + O`

---

## 性能改進數據

| 指標 | 改進前 | 改進後 |
|-----|-------|-------|
| 單次驗證超時時間 | 無限制 | 15 秒 |
| 自動重試次數 | 0 次 | 最多 3 次 |
| 失敗提示信息 | 模糊 | 詳細 |
| 驗證時間記錄 | 無 | 自動記錄 |
| 重驗提醒 | 無 | 自動提示 |

---

## 日志範例

### 成功場景
```
[DEBUG] nob.Account testuser PASS:password
[DEBUG] dataList Add
[DEBUG] Web In testuser (Attempt 1/3)
[DEBUG] 認證成功 | 賬號: testuser | 到期: 2025-12-31
認證信息已保存 | 賬號: testuser | 下次驗證: 2025-11-27 14:32:47
[DEBUG] 賬號 testuser 將在 7 天後需要重新驗證
```

### 失敗恢復
```
[DEBUG] Web In testuser (Attempt 1/3)
[DEBUG] Timeout for testuser, attempt 1
[DEBUG] Retrying testuser in 1000ms...
[DEBUG] Web In testuser (Attempt 2/3)
[DEBUG] 認證成功 | 賬號: testuser | 到期: 2025-12-31
```

### 需要重驗
```
[DEBUG] 警告: testuser 已超過重新驗證時間，建議重新驗證
MessageBox 彈窗：「賬號 testuser 需要重新驗證」
```

---

## 反饋表單

如發現問題，請記錄以下信息：

| 項目 | 內容 |
|-----|------|
| 用戶地點 | 大陸 / 台灣 / 其他 |
| 網絡環境 | 寬帶 / 移動 / 公司 |
| 驗證狀態 | 成功 / 失敗 / 超時 |
| 錯誤信息 | (複製 Debug Output 中的相關行) |
| 時間戳 | YYYY-MM-DD HH:MM:SS |

---

**版本**：1.1.0  
**測試日期**：2025-11-20  
**聯繫方式**：[開發團隊郵箱/聯繫方式]
